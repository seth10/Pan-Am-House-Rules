<script>

cruiser_unlocked = false

cruiser_status_text = {
  false: "The cruiser remains locked.",
  true: "The cruiser is unlocked!"
}

cruiser_unlock_percentages = {
  1: 7.5,
  2: 35,
  3: 100
}


jet_unlocked = false

jet_status_text = {
  false: "The jet remains locked.",
  true: "The jet is unlocked!"
}

jet_unlock_percentages = {
  1: 5,
  2: 8,
  3: 10,
  4: 20,
  5: 30,
  6: 100
}


stock_status = "No change"
stock_up_chance = 65
stock_double_chance = 10


current_bonus = "No bonus"

bonus_text = {
  1: ["Each player earns $3.",
      "Each player gains a free Trimotor.",
      "Each player draws a directive card.",
      "Starting with the first player, each player may pay $3 to place an airport.",
      "At the end of the round, Pan Am expands once along the Asia-Pacific route.",
      "At the end of the round, Pan Am expands once along the European route.",
      "At the end of the round, Pan Am expands once along the South American route.",],
  2: ["Each player earns $4.",
      "Each player gains a free Clipper or Trimotor.",
      "Increase each player's income by 2.",
      "When selling routes this round, treat the route bonus as being 1 rank higher.",
      "Each player draws a directive card.",
      "At the end of the round, Pan Am expands once along the Asia-Pacific route.",
      "At the end of the round, Pan Am expands once along the European route.",
      "At the end of the round, Pan Am expands once along the South American route.",],
  3: ["Each player may sell a plane for $5.",
     "Each player gains a free Clipper or Trimotor."
      "Increase each player's income by 2.",
      "Each player draws two directive cards.",
      "At the end of the round, each player may sell a route to Pan Am.",
      "At the end of the round, Pan Am expands once along each of the Asia-Pacific, South American, and European routes.",
      "At the end of the round, Pan Am expands twice along the Asia-Pacific route.",
      "At the end of the round, Pan Am expands twice along the European route.",
      "At the end of the round, Pan Am expands twice along the South American route.",],
     ],
  4: ["Each player earns $8",
      "Each player gains a free Cruiser or plane of lesser value."
      "Each player draws two directive cards.",
      "Starting with the first player, each player may trade in one plane for two of the same plane of lesser value.",
      "Starting with the first player, each player may purchase an available plane of any value by selling stock at its current value +$2 per share.",
      "At the end of the round, Pan Am expands once along each of the Asia-Pacific, South American, and European routes.",
      "At the end of the round, Pan Am expands twice along the Asia-Pacific route.",
      "At the end of the round, Pan Am expands twice along the European route.",
      "At the end of the round, Pan Am expands twice along the South American route.",
     ],
  5: ["Each player gains a free Cruiser or plane of lesser value.",
      "Starting with the first player, each player may purchase a plane of any value by selling stock at its current value +$2 per share.",
     ],
  6: ["Each player gains a free Cruiser or plane of lesser value.",
      "Starting with the first player, each player may sell a route to Pan Am.",
      "Each player with a Jet must sell it for $10. Lock the Jet for the rest of the game. Jets cannot be gained by any means.",],
  7: ["Each player gains a free plane of any value.",
     "Each player draws three directive cards.",
     "Starting with the first player, each player may move one of their existing airports. Repeat this until no player moves an airport. An airport may not be moved twice this way.",
     "Starting with the first player, each player may remove one Pan Am purchase marker from the board.",
     "At the end of the round, Pan Am expands twice along each of the Asia-Pacific, South American, and European routes."]
}


round_number = 0


// Adding a .sample() function to arrays to pick a random item (https://stackoverflow.com/a/33906108/5279083)
Array.prototype.sample = function(){
  return this[Math.floor(Math.random()*this.length)];
}


function start_round() {
  // If we're already on round 7, stop here and don't do anything. The game is over.
  if (round_number == 7) {
    return
  }
  
  round_number = round_number + 1
  document.getElementById("round").innerText = "Round " + round_number
  
  // Die roll: Jet. We'll roll for the jet first so if the jet unlocks, we also unlock the cruiser.
  // Math.random, here's the documentation: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random
  if ( Math.random()*100 < jet_unlock_percentages[round_number] ) {
    jet_unlocked = true
    cruiser_unlocked = true
  }
  
  // Die roll: Cruiser
  if ( Math.random()*100 < cruiser_unlock_percentages[round_number] ) {
    cruiser_unlocked = true
  }
  
  stock_status = "The stock went "
  
  if ( Math.random()*100 < stock_up_chance ) {
    stock_status = stock_status + "up "
  } else {
    stock_status = stock_status + "down "
  }
  
  if ( Math.random()*100 < stock_double_chance ) {
    stock_status = stock_status + "twice."
  } else {
    stock_status = stock_status + "once."
  }
  
  // Die roll: Bonus
  current_bonus = bonus_text[round_number].sample()
  
  // Update the output with the current status, use \n for a new line between items.
  document.getElementById("output").innerText = cruiser_status_text[cruiser_unlocked] + "\n" + jet_status_text[jet_unlocked] + "\n" + stock_status + "\n" + current_bonus
}

</script>



<button onclick="start_round()">Click to start new round</button>

<h1 id="round">The game has not yet begun.</h1>

<p id="output">Status will appear here.</p>
